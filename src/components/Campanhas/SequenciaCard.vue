<style scoped>
.card-flat {
  margin-top: 80px !important;
}
.bg-dark {
  background-color: #23b7e5 !important;
}
.btn-outline-info {
  color: white;
  border-color: white;
}
.green {
  color: green !important;
}
.holder-icon {
  left: 0;
  position: absolute;
  top: 15px;
  font-size: 22px;
}
.remove {
  position: relative;
  top: 33px;
  cursor: pointer;
}
.center {
  text-align: center;
  display: block;
}
.QuatroCincopx {
  width: 45px !important;
}
.compare {
  color: red;
  font-weight: 700;
}
.priceReal {
  color: green;
  font-weight: 700;
}
.desconto {
  color: blue;
  font-weight: 700;
}
.btnIncrementDecrement {
  height: 21px;
}
.spanIncrementDecrement {
  top: -6px;
  margin: 0 auto;
  position: relative;
}
.cursorP {
  cursor: pointer !important;
}
.btnKeepBuyingFooter {
  color: #5d9cec;
  border-color: #5d9cec;
}
.iconBadge {
  background-color: #5d9cec;
  font-size: 15px;
  color: white;
}
.iconStep {
  border-radius: 50px;
  width: 50px;
  height: 50px;
  margin: 0 auto;
  display: block;
  color: white;
  background-color: #5d9cec;
  text-align: center;
  font-size: 34px;
  margin-top: 5px;
  line-height: normal;
}
.dadosPessoais {
  font-size: 20px;
  font-weight: 900;
  top: 1px;
  position: relative;
  color: #5d9cec;
  margin-left: 10px;
}
.resumoCompra {
  font-size: 16px;
  font-weight: 900;
  top: 1px;
  position: relative;
  color: #5d9cec;
  margin-left: 10px;
}
.comandoCollapse {
  margin-left: 5px;
  top: 2px;
  position: relative;
  color: dodgerblue;
  font-size: 17px;
}
.labelForm {
  margin: 0 0 0px;

  color: #4d4d4d;
  font-weight: 700;
}
.formGroup {
  margin-bottom: 0rem;
}
.card-default {
  border-color: #5d9cec;
}
.cardSide {
  padding: 0 5px;
  box-sizing: border-box;
  border-radius: 50px;
  display: inline !important;
}
.textInformation {
  line-height: 14px;
  color: #999 !important;
  padding: 0;
  padding-left: 30px;
  float: left;
  font-size: 11px;
  margin-bottom: 10px;
}
.minusmargintop {
  margin-top: -30px !important;
}
.box-title {
  position: relative;
  padding: 0 30px 0 35px;
  box-sizing: border-box;
}
.card-default {
  border-radius: 7px;
}
.btnContinue {
  height: 50px;
  font-size: 20px;
  border-radius: 10px;
}
.rounded {
  border-radius: 7px !important;
}
.disabledBox {
  cursor: default;
  pointer-events: none;
  -moz-opacity: 0.6;
  -khtml-opacity: 0.6;
  -webkit-opacity: 0.6;
  opacity: 0.6;
}
.paddingZero {
  padding: 0;
}
.localidade {
  top: 5px !important;
  font-size: 12px;
}
.dadosPessoaisNomeCompletoVModel {
  color: #4d4d4d !important;
  font-weight: 700 !important;
  font-size: 15px;
}
.paddingTopBottomZERO {
  padding-bottom: 0px !important;
  padding-top: 0px !important;
}
.enderecoEntregaHeader {
  font-size: 15px;
  font-weight: 700;
  color: grey;
}
.opcaoSelecionada {
  background-color: #dcdcdc;
  color: black;
  font-weight: bold;
  border-color: #dcdcdc;
  border: 2px solid #ccc;
}
.opcaoDeselecionada {
  font-weight: bold;
  color: gray;
  border-color: 2px solid #23b7e5;
}
.btnFrete {
  padding: 15px;
  margin: 10px;
  cursor: pointer !important;
  border-radius: 10px;
}
.btnFormaPagamentoSelecionada {
  padding: 5px;
  margin: 5px;
  cursor: pointer !important;
  border-radius: 10px;
}
.smallInforFormaPagamentoBoleto {
  padding: 5px;
  margin: 5px;
  cursor: pointer !important;
  border-radius: 10px;
  color: black;
  background-color: #dcdcdc;
  border: 2px solid #ccc;
}
.selecionadoInfo {
  margin-top: 10px;
  color: blueviolet;
  text-align: right !important;
  float: right !important;
}
.ValorTotalResumo {
  background-color: #f5f5f5;
  border-radius: 9px;
  height: 40px;
  color: white !important;
}
.textValorTotal {
  color: black;
  font-weight: 700;
  font-size: 1.2em;
  display: block;
  margin: 0 auto;
  text-align: center;
  top: 5px;
  float: left !important;
}
.textItems {
  color: black;
  margin-bottom: 5px !important;
}
.imgVariant {
  width: 50px;
  height: 50px;
  top: 7px;
  position: relative;
}
.textInfoFrete {
  text-align: left;
  font-size: 11px;
  white-space: pre-wrap;
}
.imageCard {
  width: 25px !important;
  height: 25px !important;
}
.valorTotalCollapse {
  font-weight: 700;
  color: #3fc583 !important;
  font-size: 15px;
}
.hidden {
  display: none !important;
}
@media only screen and (max-width: 992px) {
  #btnTop {
    display: block !important;
  }
  .valorTotalCollapse {
    font-weight: 700;
    color: #3fc583 !important;
    font-size: 11px !important;
    top: 3px !important;
    position: relative;
  }
  .resumoCompra {
    font-size: 13px !important;
  }
  .comandoCollapse {
    margin-left: 5px;
    top: 0px !important;
    position: relative;
    color: dodgerblue;
    font-size: 15px !important;
  }
}
@media only screen and (max-width: 767px) {
  .QuatroCincopx {
    margin-left: 0px !important;
  }
  .remove {
    float: left;
    left: 60px;
    position: relative;
    top: -54px;
    cursor: pointer;
    font-size: 25px;
  }
  .valorTotalCollapse {
    font-weight: 700;
    color: #3fc583;
    font-size: 11px !important;
    top: 3px !important;
    position: relative;
  }
  .resumoCompra {
    font-size: 13px !important;
  }
  .comandoCollapse {
    margin-left: 5px;
    top: 0px !important;
    position: relative;
    color: dodgerblue;
    font-size: 15px !important;
  }
  .textoNaoObrigado {
    font-size: 10px !important;
  }
  .textItems {
    position: relative;
    top: 0px !important;
  }
}
</style>
<template>
  <div class="col-md-4 mt-0 mb-0 cardSide">
    <form data-vv-scope="sequencia" @submit.prevent="validateBeforeSubmit('sequencia')">
      <div class="card card-default">
        <div class="card-body">
          <div class="row">
            <div class="form-group col-md-4">
              <label class="col-form-label">Mensagem *</label>
              <select
                id="mensagem"
                name="id_mensagem"
                class="form-control text-center"
                v-validate="'required'"
                v-model="sequencia.id_mensagem"
                :class="{'is-invalid': errors.has('sequencia.id_mensagem')}"
              >
                <option
                  v-for="{id_mensagem, nome_mensagem} in arrayMensagens"
                  :key="id_mensagem"
                  :value="id_mensagem"
                  v-bind:selected="id_mensagem == sequencia.id_mensagem"
                >{{nome_mensagem}}</option>
              </select>
            </div>
            <div class="form-group col-md-3 mr-0 ml-2 pr-0 pl-0">
              <label class="col-form-label">Tempo *</label>
              <div class></div>
              <el-input-number
                :min="1"
                :max="1000000"
                v-validate="'required'"
                class="text-center"
                v-model="sequencia.tempo"
                :class="{'is-invalid': errors.has('sequencia.tempo')}"
              ></el-input-number>
            </div>
            <div class="form-group col-md-3">
              <label class="col-form-label">Tipo *</label>
              <select
                id="tipo_tempo"
                name="tipo_tempo"
                class="form-control"
                v-validate="'required'"
                v-model="sequencia.tipo_tempo"
                :class="{'is-invalid': errors.has('sequencia.tipo_tempo')}"
              >
                <option selected value="1">Segundo(s)</option>
                <option value="2">Minuto(s)</option>
                <option value="3">Hora(s)</option>
                <option value="4">Dia(s)</option>
                <option value="5">Mês(es)</option>
                <option value="6">Ano(s)</option>
              </select>
            </div>
            <div class="form-group col-md-1 mt-3 mr-0 ml-1 pr-0 pl-0">
              <label class="col-form-label"></label>
              <button class="btn btn-primary btn-block" type="submit">
                <span class="fa fa-arrow-right"></span>
              </button>
            </div>
          </div>
          <div class="form-group">
            <span
              v-show="errors.has('sequencia.id_mensagem')"
              class="invalid-feedback"
            >{{ errors.first('sequencia.id_mensagem') }}</span>
            <span
              v-show="errors.has('sequencia.tempo')"
              class="invalid-feedback"
            >{{ errors.first('sequencia.tempo') }}</span>
            <span
              v-show="errors.has('sequencia.tipo_tempo')"
              class="invalid-feedback"
            >{{ errors.first('sequencia.tipo_tempo') }}</span>
          </div>
        </div>
      </div>
    </form>
  </div>
</template>
<script>
import Vue from "vue";
import VeeValidate from "vee-validate";
import API_NOTIFICATION from "../../api/notification";
import API_PRODUTOS from "../../api/produtosAPI";
import API_LOJA from "../../api/lojaAPI";
import UTILIS_API from "../../api/utilisAPI";
import API_CHECKOUT from "../../api/checkoutAPI";
import Element from "element-ui";
import API_LOGIN from "../../api/loginAPI";
import API_HEADERS from "../../api/configAxios";
import UTILIS from "../../utilis/utilis.js";
import router from "../../router.js";
import API_MKT from "../../api/marketingAPI";
import API_MENSAGERIA from "../../api/mensageriaAPI";

Vue.use(Element);
Vue.use(VeeValidate, {
  fieldsBagName: "formFields" // fix issue with b-table
});

export default {
  name: "sequencia-card",
  created() {
    API_NOTIFICATION.ShowLoading();
    this.checkIfLogged();
   
    //document.addEventListener('beforeunload', this.clearSessionStorage);
  },
  props: {
    noCheckout: { type: Number, required: false },
     id: {type:Number, required: true},
     seq: {}
  },
  computed: {},
  data: function() {
    return {
      sequencia: {       
        id_mensagem: 2,
        tipo_tempo: 1,
        tempo: 1
      },
      arrayMensagens: [],
      arrayMensagensOriginal: []
    };
  },
  mounted() {
    this.$validator.localize("pt", {
      messages: {
        required: field => "* Este campo é obrigatório."
      },
      attributes: {}
    });
  },
  methods: {
    checkIfLogged() {
      //API_NOTIFICATION.ShowLoading();
      API_LOGIN.VerificaToken()
        .then(res => {
          API_MENSAGERIA.GetMensagens().then(resMensagens => {
            this.arrayMensagensOriginal = resMensagens.data;
            resMensagens.data.forEach((obj, i) => {
              this.arrayMensagens.push({
                id_mensagem: obj.id,
                nome_mensagem: obj.nome
              });
            });
            if(this.seq != undefined){
              this.sequencia = this.seq;
            }
            API_NOTIFICATION.HideLoading();
          });
        })
        .catch(error => {
          console.log("Erro ao verificar token", error);
          if (error.response.status === 401) {
            this.$router.go("login");
          }
        });
    },
    validateBeforeSubmit(scope) {
      this.$validator.validateAll(scope).then(result => {
        if (result) {
          this.salvarSequencia();
          return;
        }
      });
    },
    salvarSequencia() {
      var LSequencia = {id_sequencia: this.id, id_mensagem: this.sequencia.id_mensagem, tempo: this.sequencia.tempo, tipo_tempo: this.sequencia.tipo_tempo};
      this.$emit("AddSequencia", LSequencia);
    }
  }
};
</script>
